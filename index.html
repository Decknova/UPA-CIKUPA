<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ramadan Tracker Pro v26 - Zikir Update</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; -webkit-tap-highlight-color: transparent; }
        .task-card { transition: all 0.2s ease; cursor: pointer; }
        .task-card.active { border-color: #10b981; background-color: rgba(6, 78, 59, 0.5); }
        .folder-content { display: none; opacity: 0; transform: translateY(-10px); transition: all 0.3s ease; }
        .folder-content.open { display: block; opacity: 1; transform: translateY(0); }
        #chartModal, #loginOverlay { display: none; }
        .page-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .page-box { aspect-ratio: 1; border: 1px solid #1e293b; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        .page-box.active { background-color: #10b981; border-color: #10b981; color: #020617; }
        .filter-btn.active { background-color: #10b981; color: #020617; border-color: #10b981; }
        input[type="date"] { color-scheme: dark; }
    </style>
</head>
<body class="text-slate-100 min-h-screen pb-24">
    <div class="max-w-md mx-auto px-5">
        <header class="flex justify-between items-center py-8">
            <div>
                <h1 class="text-2xl font-extrabold text-emerald-400 italic uppercase tracking-tighter">RAMADAN <span class="text-white font-normal">TRACKER</span></h1>
                <p id="currentDateDisplay" class="text-slate-400 text-[10px] font-bold tracking-widest uppercase mt-1 italic"></p>
            </div>
            <button onclick="openChart()" class="bg-slate-900 p-3 rounded-2xl border border-slate-800 text-lg shadow-lg">ðŸ“Š</button>
        </header>

        <div class="bg-slate-900/80 border border-slate-800 p-5 rounded-[32px] mb-6 flex justify-between items-center shadow-xl">
            <div class="flex items-center space-x-4">
                <div id="userInitial" class="w-12 h-12 bg-emerald-500/20 rounded-2xl flex items-center justify-center text-emerald-500 font-black text-xl">?</div>
                <div>
                    <p id="userRoleLabel" class="text-[9px] font-black text-slate-500 uppercase tracking-widest">User Aktif</p>
                    <p id="activeUserName" class="font-extrabold text-white text-base">Belum Login</p>
                </div>
            </div>
            <button onclick="showLogin()" class="bg-emerald-500/10 text-emerald-400 text-[10px] font-black uppercase px-4 py-2.5 rounded-xl border border-emerald-500/20">Ganti</button>
        </div>

        <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-[32px] mb-6">
            <input type="date" id="datePicker" onchange="changeDate(this.value)" class="w-full bg-slate-800 border-none p-4 rounded-2xl text-lg font-bold outline-none text-white text-center">
        </div>

        <div id="adminUserSelector" class="bg-amber-500/10 border border-amber-500/20 p-5 rounded-[32px] mb-6 hidden text-center">
            <label class="block text-[9px] font-black uppercase text-amber-500 mb-3 tracking-widest italic">Admin Mode: Edit Member</label>
            <select id="userSelect" onchange="loadDayData()" class="w-full bg-slate-800 border-none p-4 rounded-2xl text-lg font-bold text-white outline-none">
                <option value="Arif">Arif</option><option value="Heru">Heru</option><option value="Fajar">Fajar</option><option value="Faisal">Faisal</option><option value="Mulyadi">Mulyadi</option><option value="Yudi">Yudi</option><option value="Kang Deny">Kang Deny</option>
            </select>
        </div>

        <div id="trackerContent" class="space-y-4 opacity-40 pointer-events-none transition-all duration-300">
            
            <div class="bg-slate-900/40 rounded-[32px] border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderSholat')" class="w-full p-6 flex justify-between items-center active:bg-slate-800/50">
                    <span class="font-black text-[10px] tracking-widest text-emerald-400 uppercase italic">Sholat Berjamaah</span>
                    <span>â–¼</span>
                </button>
                <div id="folderSholat" class="folder-content px-5 pb-5 space-y-3">
                    <div onclick="toggleTask(this)" data-task="Jamaah Shubuh" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Shubuh</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Dzuhur" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Dzuhur</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Ashar" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Ashar</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Maghrib" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Maghrib</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Isya" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Isya</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-[32px] border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderRawatib')" class="w-full p-6 flex justify-between items-center active:bg-slate-800/50">
                    <span class="font-black text-[10px] tracking-widest text-teal-400 uppercase italic">Sholat Rawatib</span>
                    <span>â–¼</span>
                </button>
                <div id="folderRawatib" class="folder-content px-5 pb-5 space-y-3">
                    <div onclick="toggleTask(this)" data-task="Qobliyah Shubuh" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Qobliyah Shubuh</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Qobliyah Dzuhur" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Qobliyah Dzuhur</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Dzuhur" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Dzuhur</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Maghrib" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Maghrib</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Isya" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Isya</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-[32px] border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderTilawah')" class="w-full p-6 flex justify-between items-center active:bg-slate-800/50">
                    <span class="font-black text-[10px] tracking-widest text-blue-400 uppercase italic">Tilawah (Hal 1-20)</span>
                    <span>â–¼</span>
                </button>
                <div id="folderTilawah" class="folder-content px-5 pb-5">
                    <div class="page-grid" id="pageGridContainer"></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-[32px] border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderSunnah')" class="w-full p-6 flex justify-between items-center active:bg-slate-800/50">
                    <span class="font-black text-[10px] tracking-widest text-yellow-500 uppercase italic">Sholat Sunnah</span>
                    <span>â–¼</span>
                </button>
                <div id="folderSunnah" class="folder-content px-5 pb-5 space-y-3">
                    <div onclick="toggleTask(this)" data-task="Dhuha" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Dhuha</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Tahajud" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Tahajud</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Witir" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Witir</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-[32px] border border-slate-800 overflow-hidden shadow-sm text-purple-400">
                <button onclick="toggleFolder('folderZikir')" class="w-full p-6 flex justify-between items-center active:bg-slate-800/50">
                    <span class="font-black text-[10px] tracking-widest uppercase italic">Zikir Pagi & Petang</span>
                    <span>â–¼</span>
                </button>
                <div id="folderZikir" class="folder-content px-5 pb-5 space-y-3 text-white">
                    <div onclick="toggleTask(this)" data-task="Zikir Pagi" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>ðŸŒ… Zikir Pagi</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                    <div onclick="toggleTask(this)" data-task="Zikir Petang" class="task-card bg-slate-900/80 p-5 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>ðŸŒ‡ Zikir Petang</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center text-xs"></div></div>
                </div>
            </div>

            <div onclick="toggleTask(this)" data-task="Sedekah Subuh" class="task-card bg-slate-900 p-6 rounded-[32px] flex justify-between items-center border border-slate-800 font-black italic text-emerald-400 text-sm tracking-widest uppercase"><span>Sedekah Subuh</span><div class="box w-7 h-7 border-2 border-slate-700 rounded-xl flex items-center justify-center"></div></div>
            <div onclick="toggleTask(this)" data-task="Riyadho" class="task-card bg-slate-900 p-6 rounded-[32px] flex justify-between items-center border border-slate-800 font-black italic text-rose-400 text-sm tracking-widest uppercase"><span>Riyadho</span><div class="box w-7 h-7 border-2 border-slate-700 rounded-xl flex items-center justify-center"></div></div>

            <button id="saveBtn" onclick="saveCurrentDay()" class="w-full mt-10 bg-emerald-600 text-white font-black py-6 rounded-[32px] shadow-2xl uppercase italic hidden active:scale-95 transition-transform">Simpan Progress</button>
        </div>
    </div>

    <div id="loginOverlay" class="fixed inset-0 bg-slate-950/95 z-[200] flex items-center justify-center p-6 backdrop-blur-md text-center">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-xs rounded-[48px] p-8">
            <h2 class="font-black italic text-emerald-400 text-2xl mb-8 uppercase">Login</h2>
            <div class="space-y-4">
                <select id="loginUser" class="w-full bg-slate-800 p-5 rounded-3xl font-bold text-white border border-slate-700 outline-none appearance-none">
                    <option value="Admin">--- AKSES ADMIN ---</option>
                    <option value="Arif">Arif</option><option value="Heru">Heru</option><option value="Fajar">Fajar</option><option value="Faisal">Faisal</option><option value="Mulyadi">Mulyadi</option><option value="Yudi">Yudi</option><option value="Kang Deny">Kang Deny</option>
                </select>
                <input type="password" id="loginPass" placeholder="Password" class="w-full bg-slate-800 p-5 rounded-3xl font-bold text-white border border-slate-700 text-center outline-none">
                <button onclick="processLogin()" class="w-full bg-emerald-500 text-slate-950 font-black py-5 rounded-3xl text-lg shadow-lg active:scale-95">MASUK</button>
                <button onclick="hideLogin()" class="text-slate-500 font-bold text-sm mt-6 block w-full text-center">Batal</button>
            </div>
        </div>
    </div>

    <div id="chartModal" class="fixed inset-0 bg-slate-950 z-[150] p-6 flex flex-col overflow-y-auto">
        <div class="flex justify-between items-center mb-8"><h2 class="text-xl font-black italic text-emerald-400 uppercase tracking-tighter">Statistik Grup</h2><button onclick="closeChart()" class="bg-red-500/10 text-red-500 w-12 h-12 rounded-2xl font-black text-xl border border-red-500/20">âœ•</button></div>
        
        <div class="flex space-x-2 mb-8 bg-slate-900/50 p-1.5 rounded-2xl border border-slate-800">
            <button onclick="updateTrend('daily')" id="btn-daily" class="filter-btn flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Harian</button>
            <button onclick="updateTrend('weekly')" id="btn-weekly" class="filter-btn flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Pekanan</button>
            <button onclick="updateTrend('monthly')" id="btn-monthly" class="filter-btn flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Bulanan</button>
        </div>

        <div class="bg-slate-900 p-6 rounded-[40px] border border-slate-800 mb-8 min-h-[300px]"><canvas id="progressChart"></canvas></div>
        <div id="rankTableContainer" class="pb-10"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC21Svp8RL6O3aJtRJtVCelBgGCmsJpiu8",
            authDomain: "ramdhan-tacker.firebaseapp.com",
            databaseURL: "https://ramdhan-tacker-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ramdhan-tacker",
            storageBucket: "ramdhan-tacker.firebasestorage.app",
            messagingSenderId: "776108389920",
            appId: "1:776108389920:web:da299960b00cdc09e5ee45"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dbPath = 'ramadan_db_v26';

        let userPasswords = JSON.parse(localStorage.getItem('ramadan_passwords')) || {
            "Admin": "admin123", "Arif": "1234", "Heru": "1234", "Fajar": "1234", "Faisal": "1234", "Mulyadi": "1234", "Yudi": "1234", "Kang Deny": "1234"
        };

        const names = ["Arif", "Heru", "Fajar", "Faisal", "Mulyadi", "Yudi", "Kang Deny"];
        let currentUser = localStorage.getItem('ramadan_user') || null;
        let isAdmin = localStorage.getItem('ramadan_is_admin') === 'true';
        let db = {};

        function getJakartaDate() { return new Intl.DateTimeFormat('en-CA', {timeZone: 'Asia/Jakarta', year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date()); }
        let selectedDate = getJakartaDate();

        const grid = document.getElementById('pageGridContainer');
        for(let i=1; i<=20; i++) {
            const div = document.createElement('div'); div.className = 'page-box'; div.innerText = i;
            div.dataset.task = 'Tilawah Halaman ' + i;
            div.onclick = function() { if(currentUser) toggleTask(this); };
            grid.appendChild(div);
        }

        database.ref(dbPath).on('value', (s) => { db = s.val() || {}; loadDayData(); });

        function showLogin() { document.getElementById('loginOverlay').style.display = 'flex'; }
        function hideLogin() { document.getElementById('loginOverlay').style.display = 'none'; }
        
        function processLogin() {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;
            if(userPasswords[u] === p) {
                isAdmin = (u === "Admin"); currentUser = u;
                localStorage.setItem('ramadan_is_admin', isAdmin);
                localStorage.setItem('ramadan_user', currentUser);
                checkLoginStatus(); hideLogin(); loadDayData();
            } else { alert("Password Salah!"); }
        }

        function checkLoginStatus() {
            if(!currentUser) return;
            const sl = document.getElementById('userRoleLabel');
            const nl = document.getElementById('activeUserName');
            const i = document.getElementById('userInitial');
            const adminPanel = document.getElementById('adminUserSelector');
            if(isAdmin) {
                sl.innerText = "MODE ADMIN"; nl.innerText = "Admin Akses"; i.innerText = "A";
                i.className = "w-12 h-12 bg-amber-500/20 rounded-2xl flex items-center justify-center text-amber-500 font-black text-xl";
                adminPanel.classList.remove('hidden');
            } else {
                sl.innerText = "USER AKTIF"; nl.innerText = currentUser; i.innerText = currentUser.charAt(0);
                i.className = "w-12 h-12 bg-emerald-500/20 rounded-2xl flex items-center justify-center text-emerald-500 font-black text-xl";
                adminPanel.classList.add('hidden');
            }
            document.getElementById('trackerContent').style.opacity = "1";
            document.getElementById('trackerContent').style.pointerEvents = "auto";
            document.getElementById('saveBtn').style.display = "block";
        }

        function toggleTask(el) { el.classList.toggle('active'); const b = el.querySelector('.box'); if(b) b.innerHTML = el.classList.contains('active') ? 'âœ”' : ''; }
        
        function saveCurrentDay() {
            const t = isAdmin ? document.getElementById('userSelect').value : currentUser;
            const tasks = []; document.querySelectorAll('.task-card.active, .page-box.active').forEach(el => tasks.push(el.dataset.task));
            database.ref(dbPath + '/' + t + '/' + selectedDate).set(tasks).then(() => alert(`Data ${t} Berhasil disimpan!`));
        }

        function loadDayData() {
            const t = isAdmin ? document.getElementById('userSelect').value : (currentUser || names[0]);
            const saved = (db[t] && db[t][selectedDate]) ? db[t][selectedDate] : [];
            document.querySelectorAll('.task-card, .page-box').forEach(el => {
                const s = saved.includes(el.dataset.task); el.classList.toggle('active', s);
                const b = el.querySelector('.box'); if(b) b.innerHTML = s ? 'âœ”' : '';
            });
        }

        function changeDate(d) { selectedDate = d; document.getElementById('currentDateDisplay').innerText = new Date(d).toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long', year:'numeric'}); loadDayData(); }
        function toggleFolder(id) { document.getElementById(id).classList.toggle('open'); }

        function updateTrend(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + filter).classList.add('active');
            const ctx = document.getElementById('progressChart').getContext('2d');
            let chartData = [];

            if (filter === 'daily') {
                chartData = names.map(n => (db[n] && db[n][selectedDate]) ? db[n][selectedDate].length : 0);
            } else {
                let range = (filter === 'weekly') ? 7 : 30;
                let days = [];
                for(let i=0; i<range; i++) {
                    let d = new Date(selectedDate); d.setDate(d.getDate() - i);
                    days.push(d.toISOString().split('T')[0]);
                }
                chartData = names.map(n => {
                    let sum = 0; days.forEach(tgl => { if(db[n] && db[n][tgl]) sum += db[n][tgl].length; });
                    return sum;
                });
            }

            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: names, datasets: [{ data: chartData, backgroundColor: '#10b981', borderRadius: 8 }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { beginAtZero: true, grid: { color: '#1e293b' } }, y: { ticks: { color: 'white', font: { weight: 'bold' } } } }, plugins: { legend: { display: false } } }
            });
            updateRankTable();
        }

        function updateRankTable() {
            let rd = names.map(n => {
                let t = 0; if(db[n]) Object.keys(db[n]).forEach(k => t += db[n][k].length);
                return { name: n, score: t };
            }).sort((a,b) => b.score - a.score);
            let h = `<div class="bg-slate-900 border border-slate-800 rounded-[32px] p-2 mt-4"><table class="w-full text-left text-xs"><tbody class="divide-y divide-slate-800">`;
            rd.forEach((p, i) => {
                let tr = (i===0)?"ðŸ¥‡":(i===1)?"ðŸ¥ˆ":(i===2)?"ðŸ¥‰":i+1;
                h += `<tr><td class="p-4 text-lg font-black">${tr}</td><td class="p-4 font-extrabold text-sm">${p.name}</td><td class="p-4 text-right font-black text-emerald-400">${p.score} pt</td></tr>`;
            });
            h += `</tbody></table></div>`;
            document.getElementById('rankTableContainer').innerHTML = h;
        }

        function openChart() { document.getElementById('chartModal').style.display = 'flex'; updateTrend('daily'); }
        function closeChart() { document.getElementById('chartModal').style.display = 'none'; }

        window.onload = () => { document.getElementById('datePicker').value = selectedDate; changeDate(selectedDate); checkLoginStatus(); };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan Tracker Pro v19 - Full Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; overflow-x: hidden; }
        .task-card { transition: all 0.2s ease; cursor: pointer; }
        .task-card.active { border-color: #10b981; background-color: rgba(6, 78, 59, 0.5); }
        .folder-content { display: none; opacity: 0; transform: translateY(-10px); transition: all 0.3s ease; }
        .folder-content.open { display: block; opacity: 1; transform: translateY(0); }
        #sidebar, #chartModal, #loginOverlay, #passManagerModal { display: none; }
        .sidebar-open { display: block !important; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .page-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .page-box { aspect-ratio: 1; border: 1px solid #1e293b; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; transition: all 0.2s; cursor: pointer; }
        .page-box.active { background-color: #10b981; border-color: #10b981; color: #020617; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
    </style>
</head>
<body class="text-slate-100 min-h-screen pb-20">
    <div class="max-w-md mx-auto px-5">
        <header class="flex justify-between items-center py-8">
            <div>
                <h1 class="text-2xl font-extrabold text-emerald-400 italic uppercase tracking-tighter">RAMADAN <span class="text-white font-normal">TRACKER</span></h1>
                <p id="currentDateDisplay" class="text-slate-400 text-[10px] font-bold tracking-widest uppercase mt-1 italic"></p>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="openChart()" class="bg-slate-900 p-2.5 rounded-xl border border-slate-800 text-lg">üìä</button>
                <button onclick="toggleSidebar()" class="bg-emerald-500 text-slate-950 p-2.5 rounded-xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
            </div>
        </header>

        <div id="loginStatus" class="bg-slate-900/80 border border-slate-800 p-4 rounded-3xl mb-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-emerald-500/20 rounded-full flex items-center justify-center text-emerald-500 font-bold" id="userInitial">?</div>
                <div>
                    <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest" id="userRoleLabel">User Aktif</p>
                    <p class="font-bold text-white" id="activeUserName">Belum Login</p>
                </div>
            </div>
            <button onclick="showLogin()" class="text-[10px] font-black uppercase text-emerald-500 border border-emerald-500/30 px-4 py-2 rounded-xl">Ganti User</button>
        </div>

        <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-3xl mb-4 text-center">
            <label class="block mb-2 text-[10px] font-black uppercase tracking-widest text-emerald-500">Pilih Tanggal</label>
            <input type="date" id="datePicker" onchange="changeDate(this.value)" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-2xl text-lg font-bold outline-none text-white">
        </div>

        <div id="adminUserSelector" class="bg-slate-900/50 border border-amber-500/30 p-5 rounded-3xl mb-4 hidden">
            <label class="block mb-2 text-[10px] font-black uppercase tracking-widest text-amber-500 text-center">Admin: Edit Member</label>
            <select id="userSelect" onchange="loadDayData()" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-2xl text-lg font-bold outline-none text-white">
                <option value="Arif">Arif</option><option value="Heru">Heru</option><option value="Fajar">Fajar</option><option value="Faisal">Faisal</option><option value="Mulyadi">Mulyadi</option><option value="Yudi">Yudi</option><option value="Kang Deny">Kang Deny</option>
            </select>
        </div>

        <div id="trackerContent" class="space-y-4 opacity-40 pointer-events-none transition-opacity duration-500">
            <div class="bg-slate-900/40 rounded-3xl border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderSholat')" class="w-full p-5 flex justify-between items-center hover:bg-slate-800/50 transition">
                    <span class="font-black text-[10px] tracking-widest text-emerald-400 uppercase italic">Sholat Berjamaah</span>
                    <span id="icon-folderSholat" class="text-xs text-slate-500">‚ñº</span>
                </button>
                <div id="folderSholat" class="folder-content px-4 pb-4 space-y-2">
                    <div onclick="toggleTask(this)" data-task="Jamaah Shubuh" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Shubuh</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Dzuhur" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Dzuhur</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Ashar" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Ashar</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Maghrib" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Maghrib</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Jamaah Isya" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Jamaah Isya</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-3xl border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderRawatib')" class="w-full p-5 flex justify-between items-center hover:bg-slate-800/50 transition">
                    <span class="font-black text-[10px] tracking-widest text-teal-400 uppercase italic">Sholat Rawatib</span>
                    <span id="icon-folderRawatib" class="text-xs text-slate-500">‚ñº</span>
                </button>
                <div id="folderRawatib" class="folder-content px-4 pb-4 space-y-2">
                    <div onclick="toggleTask(this)" data-task="Qobliyah Shubuh" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Qobliyah Shubuh</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Qobliyah Dzuhur" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Qobliyah Dzuhur</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Dzuhur" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Dzuhur</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Maghrib" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Maghrib</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Ba'diyah Isya" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Ba'diyah Isya</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-3xl border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderTilawah')" class="w-full p-5 flex justify-between items-center hover:bg-slate-800/50 transition">
                    <span class="font-black text-[10px] tracking-widest text-blue-400 uppercase italic">Tilawah Qur'an (Hal 1-20)</span>
                    <span id="icon-folderTilawah" class="text-xs text-slate-500">‚ñº</span>
                </button>
                <div id="folderTilawah" class="folder-content px-4 pb-4">
                    <div class="page-grid" id="pageGridContainer"></div>
                </div>
            </div>

            <div class="bg-slate-900/40 rounded-3xl border border-slate-800 overflow-hidden shadow-sm">
                <button onclick="toggleFolder('folderSunnah')" class="w-full p-5 flex justify-between items-center hover:bg-slate-800/50 transition">
                    <span class="font-black text-[10px] tracking-widest text-yellow-500 uppercase italic">Sholat Sunnah</span>
                    <span id="icon-folderSunnah" class="text-xs text-slate-500">‚ñº</span>
                </button>
                <div id="folderSunnah" class="folder-content px-4 pb-4 space-y-2">
                    <div onclick="toggleTask(this)" data-task="Dhuha" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Dhuha</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Tahajud" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Tahajud</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                    <div onclick="toggleTask(this)" data-task="Witir" class="task-card bg-slate-900/80 p-4 rounded-2xl flex justify-between items-center border border-slate-800 font-bold italic text-sm"><span>Witir</span><div class="box w-5 h-5 border-2 border-slate-700 rounded flex items-center justify-center"></div></div>
                </div>
            </div>

            <div onclick="toggleTask(this)" data-task="Sedekah Subuh" class="task-card bg-slate-900 p-5 rounded-3xl flex justify-between items-center border border-slate-800 font-bold italic text-emerald-400"><span>Sedekah Subuh</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>
            <div onclick="toggleTask(this)" data-task="Riyadho" class="task-card bg-slate-900 p-5 rounded-3xl flex justify-between items-center border border-slate-800 font-bold italic text-rose-400"><span>Riyadho</span><div class="box w-6 h-6 border-2 border-slate-700 rounded-lg flex items-center justify-center"></div></div>

            <button id="saveBtn" onclick="saveCurrentDay()" class="w-full mt-10 bg-emerald-600 text-white font-black py-5 rounded-3xl shadow-2xl uppercase italic hidden">Simpan Progress</button>
        </div>
    </div>

    <div id="loginOverlay" class="fixed inset-0 bg-slate-950/95 z-[200] flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-xs rounded-[40px] p-8 text-center">
            <h2 class="font-black italic text-emerald-400 text-xl mb-6">LOGIN</h2>
            <div class="space-y-4">
                <select id="loginUser" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-white border border-slate-700">
                    <option value="Admin">--- ADMIN ---</option>
                    <option value="Arif">Arif</option><option value="Heru">Heru</option><option value="Fajar">Fajar</option><option value="Faisal">Faisal</option><option value="Mulyadi">Mulyadi</option><option value="Yudi">Yudi</option><option value="Kang Deny">Kang Deny</option>
                </select>
                <input type="password" id="loginPass" placeholder="Password" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-white border border-slate-700 text-center">
                <button onclick="processLogin()" class="w-full bg-emerald-500 text-slate-950 font-black py-4 rounded-2xl">MASUK</button>
                <button onclick="hideLogin()" class="text-slate-500 font-bold text-xs mt-4">BATAL</button>
            </div>
        </div>
    </div>

    <div id="passManagerModal" class="fixed inset-0 bg-slate-950/95 z-[250] flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-slate-900 border border-amber-500/30 w-full max-w-xs rounded-[40px] p-8 text-center">
            <h2 class="font-black italic text-amber-500 text-lg mb-6 uppercase">Ganti Pass Member</h2>
            <div class="space-y-4">
                <select id="passTargetUser" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-white border border-slate-700">
                    <option value="Arif">Arif</option><option value="Heru">Heru</option><option value="Fajar">Fajar</option><option value="Faisal">Faisal</option><option value="Mulyadi">Mulyadi</option><option value="Yudi">Yudi</option><option value="Kang Deny">Kang Deny</option>
                </select>
                <input type="text" id="newPassValue" placeholder="Pass Baru" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-white border border-slate-700 text-center">
                <button onclick="updateMemberPassword()" class="w-full bg-amber-500 text-slate-950 font-black py-4 rounded-2xl">UPDATE</button>
                <button onclick="closePassManager()" class="text-slate-500 font-bold text-xs mt-4">TUTUP</button>
            </div>
        </div>
    </div>

    <div id="chartModal" class="fixed inset-0 bg-slate-950/98 z-[150] p-4 flex flex-col overflow-y-auto">
        <div class="flex justify-between items-center mb-6 pt-4"><h2 class="text-xl font-black italic text-emerald-400">RANKING</h2><button onclick="closeChart()" class="text-red-500 font-black text-xl">‚úï</button></div>
        <div class="bg-slate-900 p-4 rounded-3xl min-h-[250px] mb-6"><canvas id="progressChart"></canvas></div>
        <div id="rankTableContainer"></div>
        <div id="adminActionArea" class="mt-6 flex flex-col items-center"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC21SVp8RL6O3aJtRJtVCelBgGCmsJpiu8",
            authDomain: "ramdhan-tacker.firebaseapp.com",
            databaseURL: "https://ramdhan-tacker-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ramdhan-tacker",
            storageBucket: "ramdhan-tacker.firebasestorage.app",
            messagingSenderId: "776108389920",
            appId: "1:776108389920:web:da299960b00cdc09e5ee45"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let userPasswords = JSON.parse(localStorage.getItem('ramadan_passwords')) || {
            "Admin": "admin123",
            "Arif": "1234", "Heru": "1234", "Fajar": "1234", "Faisal": "1234", "Mulyadi": "1234", "Yudi": "1234", "Kang Deny": "1234"
        };

        const names = ["Arif", "Heru", "Fajar", "Faisal", "Mulyadi", "Yudi", "Kang Deny"];
        let currentUser = localStorage.getItem('ramadan_user') || null;
        let isAdmin = localStorage.getItem('ramadan_is_admin') === 'true';
        let db = {};

        function getJakartaDate() {
            return new Intl.DateTimeFormat('en-CA', {timeZone: 'Asia/Jakarta', year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date());
        }
        let selectedDate = getJakartaDate();

        const grid = document.getElementById('pageGridContainer');
        for(let i=1; i<=20; i++) {
            const div = document.createElement('div');
            div.className = 'page-box'; div.innerText = i;
            div.dataset.task = 'Tilawah Halaman ' + i;
            div.onclick = function() { if(currentUser) this.classList.toggle('active'); };
            grid.appendChild(div);
        }

        database.ref('ramadan_db_v12').on('value', (snapshot) => {
            db = snapshot.val() || {};
            loadDayData();
        });

        function showLogin() { document.getElementById('loginOverlay').style.display = 'flex'; }
        function hideLogin() { document.getElementById('loginOverlay').style.display = 'none'; }
        function openPassManager() { document.getElementById('passManagerModal').style.display = 'flex'; }
        function closePassManager() { document.getElementById('passManagerModal').style.display = 'none'; }

        function processLogin() {
            const user = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;
            if(userPasswords[user] === pass) {
                isAdmin = (user === "Admin");
                currentUser = user;
                localStorage.setItem('ramadan_is_admin', isAdmin);
                localStorage.setItem('ramadan_user', currentUser);
                checkLoginStatus(); hideLogin(); loadDayData();
            } else { alert("Password Salah!"); }
        }

        function updateMemberPassword() {
            const user = document.getElementById('passTargetUser').value;
            const newPass = document.getElementById('newPassValue').value;
            if(!newPass) return;
            userPasswords[user] = newPass;
            localStorage.setItem('ramadan_passwords', JSON.stringify(userPasswords));
            alert("Pass " + user + " diganti!"); closePassManager();
        }

        function checkLoginStatus() {
            if(!currentUser) return;
            const statusLabel = document.getElementById('userRoleLabel');
            const nameLabel = document.getElementById('activeUserName');
            const initial = document.getElementById('userInitial');
            if(isAdmin) {
                statusLabel.innerText = "MODE ADMIN"; nameLabel.innerText = "Admin";
                initial.innerText = "A"; initial.className = "w-10 h-10 bg-amber-500/20 rounded-full flex items-center justify-center text-amber-500 font-bold";
                document.getElementById('adminUserSelector').classList.remove('hidden');
            } else {
                statusLabel.innerText = "USER AKTIF"; nameLabel.innerText = currentUser;
                initial.innerText = currentUser.charAt(0); initial.className = "w-10 h-10 bg-emerald-500/20 rounded-full flex items-center justify-center text-emerald-500 font-bold";
                document.getElementById('adminUserSelector').classList.add('hidden');
            }
            document.getElementById('trackerContent').style.opacity = "1";
            document.getElementById('trackerContent').style.pointerEvents = "auto";
            document.getElementById('saveBtn').style.display = "block";
        }

        function saveCurrentDay() {
            const target = isAdmin ? document.getElementById('userSelect').value : currentUser;
            const tasks = [];
            document.querySelectorAll('.task-card.active, .page-box.active').forEach(el => tasks.push(el.dataset.task));
            database.ref('ramadan_db_v12/' + target + '/' + selectedDate).set(tasks)
            .then(() => alert("Tersimpan!"));
        }

        function loadDayData() {
            const target = isAdmin ? document.getElementById('userSelect').value : (currentUser || names[0]);
            const saved = (db[target] && db[target][selectedDate]) ? db[target][selectedDate] : [];
            document.querySelectorAll('.task-card, .page-box').forEach(el => {
                const sel = saved.includes(el.dataset.task);
                el.classList.toggle('active', sel);
                const b = el.querySelector('.box'); if(b) b.innerHTML = sel ? '‚úî' : '';
            });
        }

        function changeDate(newDate) {
            selectedDate = newDate;
            document.getElementById('currentDateDisplay').innerText = new Date(newDate).toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
            loadDayData();
        }

        function toggleTask(el) { if(currentUser) el.classList.toggle('active'); }
        function toggleFolder(id) { document.getElementById(id).classList.toggle('open'); }

        function openChart() {
            document.getElementById('chartModal').style.display = 'flex';
            const ctx = document.getElementById('progressChart').getContext('2d');
            let rd = names.map(n => {
                let t = 0; if(db[n]) Object.keys(db[n]).forEach(k => t += db[n][k].length);
                return { name: n, score: t };
            }).sort((a,b) => b.score - a.score);

            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: rd.map(d=>d.name), datasets: [{ data: rd.map(d=>d.score), backgroundColor: '#10b981' }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            let h = `<div class="bg-slate-900/50 rounded-2xl p-2"><table class="w-full text-xs text-left"><tbody class="divide-y divide-slate-800">`;
            rd.forEach((p, i) => {
                let tr = (i===0)?"ü•á":(i===1)?"ü•à":(i===2)?"ü•â":i+1;
                h += `<tr><td class="p-3 text-lg">${tr}</td><td class="p-3 font-bold">${p.name}</td><td class="p-3 text-right font-black text-emerald-500">${p.score} pt</td></tr>`;
            });
            h += `</tbody></table></div>`;
            document.getElementById('rankTableContainer').innerHTML = h;
            if(isAdmin) document.getElementById('adminActionArea').innerHTML = `<button onclick="openPassManager()" class="mt-4 text-[10px] font-black text-amber-500 border border-amber-500/30 px-6 py-3 rounded-2xl">‚öôÔ∏è KELOLA PASSWORD</button>`;
        }

        function closeChart() { document.getElementById('chartModal').style.display = 'none'; }
        window.onload = () => {
            document.getElementById('datePicker').value = selectedDate;
            changeDate(selectedDate); checkLoginStatus();
        };
    </script>
</body>
</html>
